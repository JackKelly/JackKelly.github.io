import{s as y}from"./chunk-LvLJmgfZ.js";import{i as j,p as S,u as _}from"./useEvent-BhXAndur.js";import{t as N}from"./react-Bj1aDYRI.js";import{Br as m,an as w,m as R,tn as z,zr as H}from"./cells-BvQJ_wGv.js";import{t as E}from"./compiler-runtime-B3qBwwSJ.js";import{m as M}from"./useEventListener-B3HCnU20.js";import{o as k}from"./utils-Cul5vKXJ.js";import{t as C}from"./jsx-runtime-BttUhiRM.js";import{t as F}from"./mode-COhtYT4e.js";import{t as L}from"./usePress-a6K9HmSS.js";import{n as I}from"./useDebounce-WGQaRdB8.js";import{t as O}from"./copy-icon-DQ4_WQe7.js";import{t as A}from"./purify.es-CPiHmTAE.js";import{t as T}from"./useRunCells-DCLlGGDx.js";var D=E(),c=y(N(),1),l=y(C(),1);const V=e=>{let t=(0,D.c)(16),r,a,i;t[0]===e?(r=t[1],a=t[2],i=t[3]):({href:a,children:r,...i}=e,t[0]=e,t[1]=r,t[2]=a,t[3]=i);let n=(0,c.useRef)(null),s;t[4]===a?s=t[5]:(s=()=>{let p=new URL(globalThis.location.href);p.hash=a,globalThis.history.pushState({},"",p.toString()),globalThis.dispatchEvent(new HashChangeEvent("hashchange"));let x=a.slice(1),v=document.getElementById(x);v&&v.scrollIntoView({behavior:"smooth",block:"start"})},t[4]=a,t[5]=s);let o=s,u;t[6]===o?u=t[7]:(u={onPress:()=>{o()}},t[6]=o,t[7]=u);let{pressProps:b}=L(u),f;t[8]===o?f=t[9]:(f=p=>{p.preventDefault(),o()},t[8]=o,t[9]=f);let g=f,d;return t[10]!==r||t[11]!==g||t[12]!==a||t[13]!==b||t[14]!==i?(d=(0,l.jsx)("a",{ref:n,href:a,...b,onClick:g,...i,children:r}),t[10]=r,t[11]=g,t[12]=a,t[13]=b,t[14]=i,t[15]=d):d=t[15],d};async function $(e){let t=R().inOrderIds.at(0);if(t)try{let r=await z.request({document:e,cellId:t});if(!r||r.options.length===0)return;let a=e.split(".").pop()??e,i=r.options[0],n=r.options.find(s=>s.name===a)??i;n!=null&&n.completion_info&&j.set(w,{documentation:n.completion_info})}catch(r){M.debug(`Doc lookup failed for "${e}"`,r)}}var q=E();const B=e=>{let t=(0,q.c)(8),{qualifiedName:r,children:a}=e,i;t[0]===r?i=t[1]:(i=()=>{$(r)},t[0]=r,t[1]=i);let n=I(i,100),s;t[2]===n?s=t[3]:(s=()=>n.cancel(),t[2]=n,t[3]=s);let o;return t[4]!==a||t[5]!==n||t[6]!==s?(o=(0,l.jsx)("span",{onMouseEnter:n,onMouseLeave:s,children:a}),t[4]=a,t[5]=n,t[6]=s,t[7]=o):o=t[7],o};var P=S(e=>{let t=e(T),r=e(k);if(t||r)return!1;let a=!0;try{a=F()==="read"}catch{return!0}return!a});function U(){return _(P)}var h="data-temp-href-target";A.addHook("beforeSanitizeAttributes",e=>{e.tagName==="A"&&(e.hasAttribute("target")||e.setAttribute("target","_self"),e.hasAttribute("target")&&e.setAttribute(h,e.getAttribute("target")||""))}),A.addHook("afterSanitizeAttributes",e=>{e.tagName==="A"&&e.hasAttribute(h)&&(e.setAttribute("target",e.getAttribute(h)||""),e.removeAttribute(h),e.getAttribute("target")==="_blank"&&e.setAttribute("rel","noopener noreferrer"))});function W(e){let t={USE_PROFILES:{html:!0,svg:!0,mathMl:!0},FORCE_BODY:!0,CUSTOM_ELEMENT_HANDLING:{tagNameCheck:/^(marimo-[A-Za-z][\w-]*|iconify-icon)$/,attributeNameCheck:/^[A-Za-z][\w-]*$/},SAFE_FOR_XML:!e.includes("marimo-mermaid")};return A.sanitize(e,t)}var Z=E(),G=e=>{if(e instanceof m.Element&&!/^[A-Za-z][\w-]*$/.test(e.name))return c.createElement(c.Fragment)},X=(e,t)=>{if(t instanceof m.Element&&t.name==="body"){if((0,c.isValidElement)(e)&&"props"in e){let r=e.props.children;return(0,l.jsx)(l.Fragment,{children:r})}return}},Y=(e,t)=>{if(t instanceof m.Element&&t.name==="html"){if((0,c.isValidElement)(e)&&"props"in e){let r=e.props.children;return(0,l.jsx)(l.Fragment,{children:r})}return}},J=e=>{if(e instanceof m.Element&&e.attribs&&e.name==="iframe"){let t=document.createElement("iframe");return Object.entries(e.attribs).forEach(([r,a])=>{r.startsWith('"')&&r.endsWith('"')&&(r=r.slice(1,-1)),t.setAttribute(r,a)}),(0,l.jsx)("div",{dangerouslySetInnerHTML:{__html:t.outerHTML}})}},K=e=>{if(e instanceof m.Element&&e.name==="script"){let t=e.attribs.src;if(!t)return;if(!document.querySelector(`script[src="${t}"]`)){let r=document.createElement("script");r.src=t,document.head.append(r)}return(0,l.jsx)(l.Fragment,{})}},Q=(e,t)=>{if(t instanceof m.Element&&t.name==="a"){let r=t.attribs.href;if(r!=null&&r.startsWith("#")&&!r.startsWith("#code/")){let a=null;return(0,c.isValidElement)(e)&&"props"in e&&(a=e.props.children),(0,l.jsx)(V,{href:r,...t.attribs,children:a})}}},tt=(e,t,r)=>{var a,i;if(t instanceof m.Element&&t.name==="div"&&((i=(a=t.attribs)==null?void 0:a.class)!=null&&i.includes("codehilite")))return(0,l.jsx)(rt,{children:e},r)},et=(e,t)=>{var r;if(t instanceof m.Element&&((r=t.attribs)!=null&&r["data-marimo-doc"])){let a=t.attribs["data-marimo-doc"];return(0,l.jsx)(B,{qualifiedName:a,children:e})}},rt=e=>{let t=(0,Z.c)(3),{children:r}=e,a=(0,c.useRef)(null),i;t[0]===Symbol.for("react.memo_cache_sentinel")?(i=(0,l.jsx)("div",{className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity",children:(0,l.jsx)(O,{tooltip:!1,className:"p-1",value:()=>{var o;let s=(o=a.current)==null?void 0:o.firstChild;return s&&s.textContent||""}})}),t[0]=i):i=t[0];let n;return t[1]===r?n=t[2]:(n=(0,l.jsxs)("div",{className:"relative group codehilite-wrapper",ref:a,children:[r,i]}),t[1]=r,t[2]=n),n};const at=({html:e,additionalReplacements:t=[],alwaysSanitizeHtml:r=!0})=>(0,l.jsx)(it,{html:e,alwaysSanitizeHtml:r,additionalReplacements:t});var it=({html:e,additionalReplacements:t=[],alwaysSanitizeHtml:r})=>{let a=U();return nt({html:(0,c.useMemo)(()=>r||a?W(e):e,[e,r,a]),additionalReplacements:t})};function nt({html:e,additionalReplacements:t=[]}){let r=[G,J,K,...t],a=[tt,Q,et,X,Y];return H(e,{replace:(i,n)=>{for(let s of r){let o=s(i,n);if(o)return o}return i},transform:(i,n,s)=>{for(let o of a){let u=o(i,n,s);if(u)return u}return i}})}export{at as t};
