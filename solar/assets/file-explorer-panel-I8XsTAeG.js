var He=Object.defineProperty;var Be=(t,e,i)=>e in t?He(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var R=(t,e,i)=>Be(t,typeof e!="symbol"?e+"":e,i);import{s as je}from"./chunk-LvLJmgfZ.js";import{i as $e,l as ce,n as A,p as ye,u as ae}from"./useEvent-BhXAndur.js";import{t as Ue}from"./react-Bj1aDYRI.js";import{Jr as qe,T as Ve,Xn as Le,Zr as Ke,_n as Ze}from"./cells-BvQJ_wGv.js";import"./react-dom-CSu739Rf.js";import{t as ie}from"./compiler-runtime-B3qBwwSJ.js";import"./tooltip-DuBjDOOi.js";import{h as Ge,m as Je}from"./useEventListener-B3HCnU20.js";import{t as Xe}from"./invariant-CAG_dYON.js";import{p as Ye,u as ve}from"./utils-Cul5vKXJ.js";import{S as re}from"./config-BHy9GZrJ.js";import{t as Qe}from"./jsx-runtime-BttUhiRM.js";import{n as et,t as I}from"./button-DOOm_ggu.js";import{t as he}from"./cn-BfqzeB_k.js";import{St as tt,at}from"./dist-m6mzfYjs.js";import{a as it,c as rt,i as nt,o as st,s as lt}from"./JsonOutput-Cf8A51yY.js";import"./cjs-BFk44HyO.js";import"./main-Drs5hZkn.js";import"./useNonce-CGCAoh-I.js";import{n as ot,r as me}from"./requests-DqPjMMrg.js";import{t as K}from"./createLucideIcon-C5NDK5NL.js";import{t as dt}from"./arrow-left-CgqvfuXk.js";import{n as ct,t as ht}from"./LazyAnyLanguageCodeMirror-Bd0XX4es.js";import{r as mt}from"./x-CvUjX6Qu.js";import{c as pt,i as ft,r as be}from"./download-FoG6dAm7.js";import{t as xt}from"./chevron-right-Cez-Jqdk.js";import{f as pe}from"./maps-BNf8B88H.js";import{n as ut}from"./markdown-renderer-Dyy86-0S.js";import{a as S,c as Z,p as gt,r as jt,t as yt}from"./dropdown-menu-BjqFXaqX.js";import{t as we}from"./copy-CmJTXGCp.js";import{t as ke}from"./download-Jiq5cuc9.js";import{t as vt}from"./ellipsis-vertical-49SoChzg.js";import{t as bt}from"./eye-off-D6Gma1GF.js";import{n as Fe,r as wt,t as kt}from"./types-B0GfsfZC.js";import{t as Ce}from"./file-plus-corner-BEHHIF2L.js";import{t as Ft}from"./spinner-BBkRPIE-.js";import{t as Ct}from"./refresh-ccw-ClD7bKJN.js";import{t as Nt}from"./refresh-cw-g2lXkmkk.js";import{t as St}from"./save-XAnt-ceT.js";import{t as Dt}from"./trash-2-xM9f8S8N.js";import{t as Pt}from"./triangle-alert-CEPiiwZT.js";import{i as _t,n as Ot,t as zt}from"./es-BAwLP160.js";import"./dist-Sapk1n6W.js";import"./dist-DAxpo7DH.js";import"./dist-Dw5p3QBM.js";import"./dist-ChjglRRU.js";import"./dist-Dq6dViu8.js";import{t as W}from"./use-toast-CAzHts2e.js";import{t as fe}from"./paths-gUC_uwid.js";import"./session-BH_ggR75.js";import{r as Mt}from"./useTheme-BHn95Ieq.js";import"./Combination-CdkqT4eF.js";import{t as M}from"./tooltip-D13BIptq.js";import"./dates-CeHtKOEz.js";import{o as Rt}from"./alert-dialog-Btfo5nE7.js";import"./popover-Ds94yD5w.js";import{n as Ne}from"./ImperativeModal-BcWA2M3r.js";import{r as At}from"./errors-CZb6hI2x.js";import{n as Wt}from"./blob-CTort_or.js";import"./vega-loader.browser-BR6dmQ_3.js";import"./defaultLocale-YxeC1tYk.js";import"./defaultLocale-BgG6rTtO.js";import{t as ne}from"./copy-fZotD7fi.js";import"./purify.es-CPiHmTAE.js";import{a as It,i as Et,n as xe,r as Tt,t as Ht}from"./tree-CLkssdQm.js";import{n as Bt,t as $t}from"./alert-Djvdl92y.js";import{n as Se}from"./error-banner-ClreFLcv.js";import{n as De}from"./useAsyncData-BwpzRwt1.js";import"./chunk-5FQGJX7Z-BuHQ2zZJ.js";import"./katex-bTFStUqL.js";import"./html-to-image-DvPYLUI8.js";import{o as Ut}from"./focus-CPRFg4kn.js";import{a as qt}from"./renderShortcut-DpJiiIXp.js";import{t as Vt}from"./bundle.esm-CvMga-X6.js";import{t as Lt}from"./links-C5-xPFlM.js";import{t as Kt}from"./icon-32x32-BRWY2pQ7.js";import{t as G}from"./Inputs-fHea2UE1.js";var Zt=K("copy-minus",[["line",{x1:"12",x2:"18",y1:"15",y2:"15",key:"1nscbv"}],["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),Pe=K("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),_e=K("list-tree",[["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"M3 10a2 2 0 0 0 2 2h3",key:"1npucw"}],["path",{d:"M3 5v12a2 2 0 0 0 2 2h3",key:"x1gjn2"}]]),Gt=K("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),Jt=K("square-play",[["rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",key:"h1oib"}],["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}]]),Xt=K("view",[["path",{d:"M21 17v2a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2",key:"mrq65r"}],["path",{d:"M21 7V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2",key:"be3xqs"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["path",{d:"M18.944 12.33a1 1 0 0 0 0-.66 7.5 7.5 0 0 0-13.888 0 1 1 0 0 0 0 .66 7.5 7.5 0 0 0 13.888 0",key:"11ak4c"}]]),Oe=ie(),F=je(Ue(),1),a=je(Qe(),1),ze=(0,F.createContext)(null);function Yt(){return(0,F.useContext)(ze)??void 0}var Qt=t=>{let e=(0,Oe.c)(3),{children:i}=t,n=Et(),s;return e[0]!==i||e[1]!==n?(s=(0,a.jsx)(ze.Provider,{value:n,children:i}),e[0]=i,e[1]=n,e[2]=s):s=e[2],s};const ea=t=>{let e=(0,Oe.c)(5),{children:i}=t,[n,s]=(0,F.useState)(null),r;e[0]!==i||e[1]!==n?(r=n&&(0,a.jsx)(It,{backend:Tt,options:{rootElement:n},children:(0,a.jsx)(Qt,{children:i})}),e[0]=i,e[1]=n,e[2]=r):r=e[2];let d;return e[3]===r?d=e[4]:(d=(0,a.jsx)("div",{ref:s,className:"contents",children:r}),e[3]=r,e[4]=d),d};var ue=new Map;const ta=({file:t,onOpenNotebook:e})=>{let{theme:i}=Mt(),{sendFileDetails:n,sendUpdateFile:s}=me(),r=ae(Ye),d=ae(ve),h=ae(qe),[m,p]=(0,F.useState)(""),{data:l,isPending:u,error:y,setData:g,refetch:c}=De(async()=>{let o=await n({path:t.path}),j=o.contents||"";return p(ue.get(t.path)||j),o},[t.path]),v=async()=>{m!==(l==null?void 0:l.contents)&&await s({path:t.path,contents:m}).then(o=>{o.success&&(g(j=>({...j,contents:m})),p(m))})},C=(0,F.useRef)(m);if(C.current=m,(0,F.useEffect)(()=>()=>{if(!(l!=null&&l.contents))return;let o=C.current;o===l.contents?ue.delete(t.path):ue.set(t.path,o)},[t.path,l==null?void 0:l.contents]),y)return(0,a.jsx)(Se,{error:y});if(u||!l)return null;let x=l.mimeType||"text/plain",D=x in ge,k=h&&l.file.isMarimoFile&&(t.path===h||t.path.endsWith(`/${h}`));if(!l.contents&&!D)return(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 p-6",children:[(0,a.jsx)("div",{className:"font-bold text-muted-foreground",children:"Name"}),(0,a.jsx)("div",{children:l.file.name}),(0,a.jsx)("div",{className:"font-bold text-muted-foreground",children:"Type"}),(0,a.jsx)("div",{children:x})]});let b=(0,a.jsxs)("div",{className:"text-xs text-muted-foreground p-1 flex justify-end gap-2 border-b",children:[(0,a.jsx)(M,{content:"Refresh",children:(0,a.jsx)(G,{size:"small",onClick:c,children:(0,a.jsx)(Nt,{})})}),t.isMarimoFile&&!re()&&(0,a.jsx)(M,{content:"Open notebook",children:(0,a.jsx)(G,{size:"small",onClick:o=>e(o),children:(0,a.jsx)(pe,{})})}),!d&&(0,a.jsx)(M,{content:"Download",children:(0,a.jsx)(G,{size:"small",onClick:()=>{if(Me(x)){ft(ut(l.contents,x),l.file.name);return}be(new Blob([l.contents||m],{type:x}),l.file.name)},children:(0,a.jsx)(ke,{})})}),!Me(x)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(M,{content:"Copy contents to clipboard",children:(0,a.jsx)(G,{size:"small",onClick:async()=>{await ne(m)},children:(0,a.jsx)(we,{})})}),(0,a.jsx)(M,{content:qt("global.save"),children:(0,a.jsx)(G,{size:"small",color:m===l.contents?void 0:"green",onClick:v,disabled:m===l.contents,children:(0,a.jsx)(St,{})})})]})]});return x.startsWith("image/")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(st,{base64:l.contents,mime:x})})]}):x==="text/csv"&&l.contents?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(it,{contents:l.contents})})]}):x.startsWith("audio/")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(nt,{base64:l.contents,mime:x})})]}):x.startsWith("video/")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(rt,{base64:l.contents,mime:x})})]}):x.startsWith("application/pdf")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(lt,{base64:l.contents,mime:x})})]}):(0,a.jsxs)(a.Fragment,{children:[b,k&&(0,a.jsxs)($t,{variant:"warning",className:"rounded-none",children:[(0,a.jsx)(Pt,{className:"h-4 w-4"}),(0,a.jsx)(Bt,{children:"Editing the notebook file directly while running in marimo's editor may cause unintended changes. Please use with caution."})]}),(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:(0,a.jsx)(F.Suspense,{children:(0,a.jsx)(ht,{theme:i==="dark"?"dark":"light",language:ge[x]||ge.default,className:"border-b",extensions:[at.lineWrapping,tt.of([{key:r.getHotkey("global.save").key,stopPropagation:!0,run:()=>m===l.contents?!1:(v(),!0)}])],value:m,onChange:p})})})]})};var Me=t=>t?t.startsWith("image/")||t.startsWith("audio/")||t.startsWith("video/")||t.startsWith("application/pdf"):!1,ge={"application/javascript":"javascript","text/markdown":"markdown","text/html":"html","text/css":"css","text/x-python":"python","application/json":"json","application/xml":"xml","text/x-yaml":"yaml","text/csv":"markdown","text/plain":"markdown",default:"markdown"},aa=class{constructor(t){R(this,"delegate",new xe([]));R(this,"rootPath","");R(this,"onChange",Ge.NOOP);R(this,"path",new fe("/"));R(this,"initialize",async t=>{if(this.onChange=t,this.delegate.data.length===0)try{let e=await this.callbacks.listFiles({path:this.rootPath});this.delegate=new xe(e.files),this.rootPath=e.root,this.path=fe.guessDeliminator(e.root)}catch(e){W({title:"Failed",description:At(e)})}this.onChange(this.delegate.data)});R(this,"refreshAll",async t=>{let e=[this.rootPath,...t.map(n=>{var s;return(s=this.delegate.find(n))==null?void 0:s.data.path})].filter(Boolean),i=await Promise.all(e.map(n=>this.callbacks.listFiles({path:n}).catch(()=>({files:[]}))));for(let[n,s]of e.entries()){let r=i[n];s===this.rootPath?this.delegate=new xe(r.files):this.delegate.update({id:s,changes:{children:r.files}})}this.onChange(this.delegate.data)});R(this,"relativeFromRoot",t=>{let e=this.rootPath.endsWith(this.path.deliminator)?this.rootPath:`${this.rootPath}${this.path.deliminator}`;return t.startsWith(e)?t.slice(e.length):t});R(this,"handleResponse",t=>t.success?t:(W({title:"Failed",description:t.message}),null));this.callbacks=t}async expand(t){let e=this.delegate.find(t);if(!e||!e.data.isDirectory)return!1;if(e.children&&e.children.length>0)return!0;let i=await this.callbacks.listFiles({path:e.data.path});return this.delegate.update({id:t,changes:{children:i.files}}),this.onChange(this.delegate.data),!0}async rename(t,e){let i=this.delegate.find(t);if(!i)return;let n=i.data.path,s=this.path.join(this.path.dirname(n),e);await this.callbacks.renameFileOrFolder({path:n,newPath:s}).then(this.handleResponse),this.delegate.update({id:t,changes:{name:e,path:s}}),this.onChange(this.delegate.data),await this.refreshAll([s])}async move(t,e){var n;let i=e?((n=this.delegate.find(e))==null?void 0:n.data.path)??e:this.rootPath;await Promise.all(t.map(s=>{this.delegate.move({id:s,parentId:e,index:0});let r=this.delegate.find(s);if(!r)return Promise.resolve();let d=this.path.join(i,this.path.basename(r.data.path));return this.delegate.update({id:s,changes:{path:d}}),this.callbacks.renameFileOrFolder({path:r.data.path,newPath:d}).then(this.handleResponse)})),this.onChange(this.delegate.data),await this.refreshAll([i])}async createFile(t,e){var s;let i=e?((s=this.delegate.find(e))==null?void 0:s.data.path)??e:this.rootPath,n=await this.callbacks.createFileOrFolder({path:i,type:"file",name:t}).then(this.handleResponse);n!=null&&n.info&&(this.delegate.create({parentId:e,index:0,data:n.info}),this.onChange(this.delegate.data),await this.refreshAll([i]))}async createFolder(t,e){var s;let i=e?((s=this.delegate.find(e))==null?void 0:s.data.path)??e:this.rootPath,n=await this.callbacks.createFileOrFolder({path:i,type:"directory",name:t}).then(this.handleResponse);n!=null&&n.info&&(this.delegate.create({parentId:e,index:0,data:n.info}),this.onChange(this.delegate.data),await this.refreshAll([i]))}async delete(t){let e=this.delegate.find(t);e&&(await this.callbacks.deleteFileOrFolder({path:e.data.path}).then(this.handleResponse),this.delegate.drop({id:t}),this.onChange(this.delegate.data))}};const Re=ye(t=>{let e=t(ot);return Xe(e,"no requestClientAtom set"),new aa({listFiles:e.sendListFiles,createFileOrFolder:e.sendCreateFileOrFolder,deleteFileOrFolder:e.sendDeleteFileOrFolder,renameFileOrFolder:e.sendRenameFileOrFolder})}),ia=ye({});async function ra(){await $e.get(Re).refreshAll([])}var na=ie(),sa=1024*1024*100;function Ae(t){let e=(0,na.c)(7),i;e[0]===t?i=e[1]:(i=t===void 0?{}:t,e[0]=t,e[1]=i);let n=i,{sendCreateFileOrFolder:s}=me(),r;e[2]===s?r=e[3]:(r=async h=>{if(h.length===0)return;let m=h.length===1;await pt(m?"Uploading file...":"Uploading files...",async p=>{p.addTotal(h.length);for(let l of h){let u=ma(ha(l)),y="";u&&(y=fe.guessDeliminator(u).dirname(u));let g=(await Wt(l)).split(",")[1];await s({path:y,type:"file",name:l.name,contents:g}),p.increment(1)}await ra()},{title:m?"File uploaded":`${h.length} files uploaded`})},e[2]=s,e[3]=r);let d;return e[4]!==n||e[5]!==r?(d={multiple:!0,maxSize:sa,onError:ca,onDropRejected:la,onDrop:r,...n},e[4]=n,e[5]=r,e[6]=d):d=e[6],zt(d)}function la(t){W({title:"File upload failed",description:(0,a.jsx)("div",{className:"flex flex-col gap-1",children:t.map(oa)}),variant:"danger"})}function oa(t){return(0,a.jsxs)("div",{children:[t.file.name," (",t.errors.map(da).join(", "),")"]},t.file.name)}function da(t){return t.message}function ca(t){Je.error(t),W({title:"File upload failed",description:t.message,variant:"danger"})}function ha(t){if(t.webkitRelativePath)return t.webkitRelativePath;if("path"in t&&typeof t.path=="string")return t.path;if("relativePath"in t&&typeof t.relativePath=="string")return t.relativePath}function ma(t){if(t)return t.replace(/^\/+/,"")}var J=ie(),pa=Ke("marimo:showHiddenFiles",!0,Ze,{getOnInit:!0}),We=F.createContext(null);const fa=t=>{let e=(0,J.c)(68),{height:i}=t,n=(0,F.useRef)(null),s=Yt(),[r]=ce(Re),d;e[0]===Symbol.for("react.memo_cache_sentinel")?(d=[],e[0]=d):d=e[0];let[h,m]=(0,F.useState)(d),[p,l]=(0,F.useState)(null),[u,y]=ce(pa),{openPrompt:g}=Ne(),[c,v]=ce(ia),C;e[1]===r?C=e[2]:(C=()=>r.initialize(m),e[1]=r,e[2]=C);let x;e[3]===Symbol.for("react.memo_cache_sentinel")?(x=[],e[3]=x):x=e[3];let{isPending:D,error:k}=De(C,x),b;e[4]!==c||e[5]!==r?(b=()=>{r.refreshAll(Object.keys(c).filter(f=>c[f]))},e[4]=c,e[5]=r,e[6]=b):b=e[6];let o=A(b),j;e[7]!==y||e[8]!==u?(j=()=>{y(!u)},e[7]=y,e[8]=u,e[9]=j):j=e[9];let P=A(j),_;e[10]!==g||e[11]!==r?(_=async()=>{g({title:"Folder name",onConfirm:async f=>{r.createFolder(f,null)}})},e[10]=g,e[11]=r,e[12]=_):_=e[12];let N=A(_),O;e[13]!==g||e[14]!==r?(O=async()=>{g({title:"File name",onConfirm:async f=>{r.createFile(f,null)}})},e[13]=g,e[14]=r,e[15]=O):O=e[15];let se=A(O),X;e[16]===v?X=e[17]:(X=()=>{var f;(f=n.current)==null||f.closeAll(),v({})},e[16]=v,e[17]=X);let le=A(X),Y;e[18]!==h||e[19]!==u?(Y=Ee(h,u),e[18]=h,e[19]=u,e[20]=Y):Y=e[20];let oe=Y;if(D){let f;return e[21]===Symbol.for("react.memo_cache_sentinel")?(f=(0,a.jsx)(Ft,{size:"medium",centered:!0}),e[21]=f):f=e[21],f}if(k){let f;return e[22]===k?f=e[23]:(f=(0,a.jsx)(Se,{error:k}),e[22]=k,e[23]=f),f}if(p){let f;e[24]===Symbol.for("react.memo_cache_sentinel")?(f=()=>l(null),e[24]=f):f=e[24];let w;e[25]===Symbol.for("react.memo_cache_sentinel")?(w=(0,a.jsx)(I,{onClick:f,"data-testid":"file-explorer-back-button",variant:"text",size:"xs",className:"mb-0",children:(0,a.jsx)(dt,{size:16})}),e[25]=w):w=e[25];let z;e[26]===p.name?z=e[27]:(z=(0,a.jsxs)("div",{className:"flex items-center pl-1 pr-3 shrink-0 border-b justify-between",children:[w,(0,a.jsx)("span",{className:"font-bold",children:p.name})]}),e[26]=p.name,e[27]=z);let V;e[28]!==p.path||e[29]!==r?(V=Te=>Ie(Te,r.relativeFromRoot(p.path)),e[28]=p.path,e[29]=r,e[30]=V):V=e[30];let L;e[31]!==p||e[32]!==V?(L=(0,a.jsx)(F.Suspense,{children:(0,a.jsx)(ta,{onOpenNotebook:V,file:p})}),e[31]=p,e[32]=V,e[33]=L):L=e[33];let te;return e[34]!==z||e[35]!==L?(te=(0,a.jsxs)(a.Fragment,{children:[z,L]}),e[34]=z,e[35]=L,e[36]=te):te=e[36],te}let E;e[37]!==le||e[38]!==se||e[39]!==N||e[40]!==P||e[41]!==o||e[42]!==r?(E=(0,a.jsx)(ua,{onRefresh:o,onHidden:P,onCreateFile:se,onCreateFolder:N,onCollapseAll:le,tree:r}),e[37]=le,e[38]=se,e[39]=N,e[40]=P,e[41]=o,e[42]=r,e[43]=E):E=e[43];let de=i-33,T,H,B;e[44]===r?(T=e[45],H=e[46],B=e[47]):(T=async f=>{let{ids:w}=f;for(let z of w)await r.delete(z)},H=async f=>{let{id:w,name:z}=f;await r.rename(w,z)},B=async f=>{let{dragIds:w,parentId:z}=f;await r.move(w,z)},e[44]=r,e[45]=T,e[46]=H,e[47]=B);let Q;e[48]===Symbol.for("react.memo_cache_sentinel")?(Q=f=>{let w=f[0];w&&(w.data.isDirectory||l(w.data))},e[48]=Q):Q=e[48];let $;e[49]!==c||e[50]!==v||e[51]!==r?($=async f=>{if(await r.expand(f)){let w=c[f]??!1;v({...c,[f]:!w})}},e[49]=c,e[50]=v,e[51]=r,e[52]=$):$=e[52];let U;e[53]!==s||e[54]!==c||e[55]!==de||e[56]!==T||e[57]!==H||e[58]!==B||e[59]!==$||e[60]!==oe?(U=(0,a.jsx)(Ht,{width:"100%",ref:n,height:de,className:"h-full",data:oe,initialOpenState:c,openByDefault:!1,dndManager:s,renderCursor:wa,disableDrop:ka,onDelete:T,onRename:H,onMove:B,onSelect:Q,onToggle:$,padding:15,rowHeight:30,indent:xa,overscanCount:1e3,disableMultiSelection:!0,children:ya}),e[53]=s,e[54]=c,e[55]=de,e[56]=T,e[57]=H,e[58]=B,e[59]=$,e[60]=oe,e[61]=U):U=e[61];let q;e[62]!==U||e[63]!==r?(q=(0,a.jsx)(We,{value:r,children:U}),e[62]=U,e[63]=r,e[64]=q):q=e[64];let ee;return e[65]!==E||e[66]!==q?(ee=(0,a.jsxs)(a.Fragment,{children:[E,q]}),e[65]=E,e[66]=q,e[67]=ee):ee=e[67],ee};var xa=15,ua=t=>{let e=(0,J.c)(34),{onRefresh:i,onHidden:n,onCreateFile:s,onCreateFolder:r,onCollapseAll:d}=t,h;e[0]===Symbol.for("react.memo_cache_sentinel")?(h={noDrag:!0,noDragEventsBubbling:!0},e[0]=h):h=e[0];let{getRootProps:m,getInputProps:p}=Ae(h),l;e[1]===Symbol.for("react.memo_cache_sentinel")?(l=(0,a.jsx)(Ce,{size:16}),e[1]=l):l=e[1];let u;e[2]===s?u=e[3]:(u=(0,a.jsx)(M,{content:"Add file",children:(0,a.jsx)(I,{"data-testid":"file-explorer-add-file-button",onClick:s,variant:"text",size:"xs",children:l})}),e[2]=s,e[3]=u);let y;e[4]===Symbol.for("react.memo_cache_sentinel")?(y=(0,a.jsx)(Pe,{size:16}),e[4]=y):y=e[4];let g;e[5]===r?g=e[6]:(g=(0,a.jsx)(M,{content:"Add folder",children:(0,a.jsx)(I,{"data-testid":"file-explorer-add-folder-button",onClick:r,variant:"text",size:"xs",children:y})}),e[5]=r,e[6]=g);let c;e[7]===m?c=e[8]:(c=m({}),e[7]=m,e[8]=c);let v,C;e[9]===Symbol.for("react.memo_cache_sentinel")?(v=et({variant:"text",size:"xs"}),C=(0,a.jsx)(_t,{size:16}),e[9]=v,e[10]=C):(v=e[9],C=e[10]);let x;e[11]===c?x=e[12]:(x=(0,a.jsx)(M,{content:"Upload file",children:(0,a.jsx)("button",{"data-testid":"file-explorer-upload-button",...c,className:v,children:C})}),e[11]=c,e[12]=x);let D;e[13]===p?D=e[14]:(D=p({}),e[13]=p,e[14]=D);let k;e[15]===D?k=e[16]:(k=(0,a.jsx)("input",{...D,type:"file"}),e[15]=D,e[16]=k);let b;e[17]===Symbol.for("react.memo_cache_sentinel")?(b=(0,a.jsx)(Ct,{size:16}),e[17]=b):b=e[17];let o;e[18]===i?o=e[19]:(o=(0,a.jsx)(M,{content:"Refresh",children:(0,a.jsx)(I,{"data-testid":"file-explorer-refresh-button",onClick:i,variant:"text",size:"xs",children:b})}),e[18]=i,e[19]=o);let j;e[20]===Symbol.for("react.memo_cache_sentinel")?(j=(0,a.jsx)(bt,{size:16}),e[20]=j):j=e[20];let P;e[21]===n?P=e[22]:(P=(0,a.jsx)(M,{content:"Toggle hidden files",children:(0,a.jsx)(I,{"data-testid":"file-explorer-hidden-files-button",onClick:n,variant:"text",size:"xs",children:j})}),e[21]=n,e[22]=P);let _;e[23]===Symbol.for("react.memo_cache_sentinel")?(_=(0,a.jsx)(Zt,{size:16}),e[23]=_):_=e[23];let N;e[24]===d?N=e[25]:(N=(0,a.jsx)(M,{content:"Collapse all folders",children:(0,a.jsx)(I,{"data-testid":"file-explorer-collapse-button",onClick:d,variant:"text",size:"xs",children:_})}),e[24]=d,e[25]=N);let O;return e[26]!==k||e[27]!==o||e[28]!==P||e[29]!==N||e[30]!==u||e[31]!==g||e[32]!==x?(O=(0,a.jsxs)("div",{className:"flex items-center justify-end px-2 shrink-0 border-b",children:[u,g,x,k,o,P,N]}),e[26]=k,e[27]=o,e[28]=P,e[29]=N,e[30]=u,e[31]=g,e[32]=x,e[33]=O):O=e[33],O},ga=t=>{let e=(0,J.c)(9),{node:i,onOpenMarimoFile:n}=t,s;e[0]===i?s=e[1]:(s=h=>{i.data.isDirectory||(h.stopPropagation(),i.select())},e[0]=i,e[1]=s);let r;e[2]!==i.data.isMarimoFile||e[3]!==n?(r=i.data.isMarimoFile&&!re()&&(0,a.jsxs)("span",{className:"shrink-0 ml-2 text-sm hidden group-hover:inline hover:underline",onClick:n,children:["open ",(0,a.jsx)(pe,{className:"inline ml-1",size:12})]}),e[2]=i.data.isMarimoFile,e[3]=n,e[4]=r):r=e[4];let d;return e[5]!==i.data.name||e[6]!==s||e[7]!==r?(d=(0,a.jsxs)("span",{className:"flex-1 overflow-hidden text-ellipsis",onClick:s,children:[i.data.name,r]}),e[5]=i.data.name,e[6]=s,e[7]=r,e[8]=d):d=e[8],d},ja=t=>{let e=(0,J.c)(10),{node:i}=t,n=(0,F.useRef)(null),s,r;e[0]===i.data.name?(s=e[1],r=e[2]):(s=()=>{var p,l;(p=n.current)==null||p.focus(),(l=n.current)==null||l.setSelectionRange(0,i.data.name.lastIndexOf("."))},r=[i.data.name],e[0]=i.data.name,e[1]=s,e[2]=r),(0,F.useEffect)(s,r);let d,h;e[3]===i?(d=e[4],h=e[5]):(d=()=>i.reset(),h=p=>{p.key==="Escape"&&i.reset(),p.key==="Enter"&&i.submit(p.currentTarget.value)},e[3]=i,e[4]=d,e[5]=h);let m;return e[6]!==i.data.name||e[7]!==d||e[8]!==h?(m=(0,a.jsx)("input",{ref:n,className:"flex-1 bg-transparent border border-border text-muted-foreground",defaultValue:i.data.name,onClick:Fa,onBlur:d,onKeyDown:h}),e[6]=i.data.name,e[7]=d,e[8]=h,e[9]=m):m=e[9],m},ya=({node:t,style:e,dragHandle:i})=>{let{openFile:n,sendCreateFileOrFolder:s,sendFileDetails:r}=me(),d=ae(ve),h=t.data.isDirectory?"directory":wt(t.data.name),m=kt[h],{openConfirm:p,openPrompt:l}=Ne(),{createNewCell:u}=Ve(),y=Ut(),g=o=>{u({code:o,before:!1,cellId:y??"__end__"})},c=(0,F.use)(We),v=async o=>{Ie(o,c?c.relativeFromRoot(t.data.path):t.data.path)},C=async o=>{o.stopPropagation(),o.preventDefault(),p({title:"Delete file",description:`Are you sure you want to delete ${t.data.name}?`,confirmAction:(0,a.jsx)(Rt,{onClick:async()=>{await t.tree.delete(t.id)},"aria-label":"Confirm",children:"Delete"})})},x=A(async()=>{t.open(),l({title:"Folder name",onConfirm:async o=>{c==null||c.createFolder(o,t.id)}})}),D=A(async()=>{t.open(),l({title:"File name",onConfirm:async o=>{c==null||c.createFile(o,t.id)}})}),k=A(async()=>{var _;if(!c||t.data.isDirectory)return;let[o,j]=Ot(t.data.name),P=`${o}_copy${j}`;try{let N=await r({path:t.data.path}),O=((_=t.parent)==null?void 0:_.data.path)||"";await s({path:O,type:"file",name:P,contents:N.contents?btoa(N.contents):void 0}),await c.refreshAll([O])}catch{W({title:"Failed to duplicate file",description:"Unable to create a duplicate of the file",variant:"danger"})}}),b=()=>{let o={size:14,strokeWidth:1.5,className:"mr-2"};return(0,a.jsxs)(jt,{align:"end",className:"print:hidden w-[220px]",onClick:j=>j.stopPropagation(),onCloseAutoFocus:j=>j.preventDefault(),children:[!t.data.isDirectory&&(0,a.jsxs)(S,{onSelect:()=>t.select(),children:[(0,a.jsx)(Xt,{...o}),"Open file"]}),!t.data.isDirectory&&!re()&&(0,a.jsxs)(S,{onSelect:()=>{n({path:t.data.path})},children:[(0,a.jsx)(pe,{...o}),"Open file in external editor"]}),t.data.isDirectory&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(S,{onSelect:()=>D(),children:[(0,a.jsx)(Ce,{...o}),"Create file"]}),(0,a.jsxs)(S,{onSelect:()=>x(),children:[(0,a.jsx)(Pe,{...o}),"Create folder"]}),(0,a.jsx)(Z,{})]}),(0,a.jsxs)(S,{onSelect:()=>t.edit(),children:[(0,a.jsx)(Gt,{...o}),"Rename"]}),!t.data.isDirectory&&(0,a.jsxs)(S,{onSelect:k,children:[(0,a.jsx)(we,{...o}),"Duplicate"]}),(0,a.jsxs)(S,{onSelect:async()=>{await ne(t.data.path),W({title:"Copied to clipboard"})},children:[(0,a.jsx)(_e,{...o}),"Copy path"]}),c&&(0,a.jsxs)(S,{onSelect:async()=>{await ne(c.relativeFromRoot(t.data.path)),W({title:"Copied to clipboard"})},children:[(0,a.jsx)(_e,{...o}),"Copy relative path"]}),(0,a.jsx)(Z,{}),(0,a.jsxs)(S,{onSelect:()=>{let{path:j}=t.data;g(Fe[h](j))},children:[(0,a.jsx)(ct,{...o}),"Insert snippet for reading file"]}),(0,a.jsxs)(S,{onSelect:async()=>{W({title:"Copied to clipboard",description:"Code to open the file has been copied to your clipboard. You can also drag and drop this file into the editor"});let{path:j}=t.data;await ne(Fe[h](j))},children:[(0,a.jsx)(Le,{...o}),"Copy snippet for reading file"]}),t.data.isMarimoFile&&!re()&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z,{}),(0,a.jsxs)(S,{onSelect:v,children:[(0,a.jsx)(Jt,{...o}),"Open notebook"]})]}),(0,a.jsx)(Z,{}),!t.data.isDirectory&&!d&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(S,{onSelect:async()=>{let j=(await r({path:t.data.path})).contents||"";be(new Blob([j]),t.data.name)},children:[(0,a.jsx)(ke,{...o}),"Download"]}),(0,a.jsx)(Z,{})]}),(0,a.jsxs)(S,{onSelect:C,variant:"danger",children:[(0,a.jsx)(Dt,{...o}),"Delete"]})]})};return(0,a.jsxs)("div",{style:e,ref:i,className:he("flex items-center cursor-pointer ml-1 text-muted-foreground whitespace-nowrap group"),draggable:!0,onClick:o=>{o.stopPropagation(),t.data.isDirectory&&t.toggle()},children:[(0,a.jsx)(va,{node:t}),(0,a.jsxs)("span",{className:he("flex items-center pl-1 py-1 cursor-pointer hover:bg-accent/50 hover:text-accent-foreground rounded-l flex-1 overflow-hidden group",t.willReceiveDrop&&t.data.isDirectory&&"bg-accent/80 hover:bg-accent/80 text-accent-foreground"),children:[t.data.isMarimoFile?(0,a.jsx)("img",{src:Kt,className:"w-5 h-5 shrink-0 mr-2 filter grayscale",alt:"Marimo"}):(0,a.jsx)(m,{className:"w-5 h-5 shrink-0 mr-2",strokeWidth:1.5}),t.isEditing?(0,a.jsx)(ja,{node:t}):(0,a.jsx)(ga,{node:t,onOpenMarimoFile:v}),(0,a.jsxs)(yt,{modal:!1,children:[(0,a.jsx)(gt,{asChild:!0,tabIndex:-1,onClick:o=>o.stopPropagation(),children:(0,a.jsx)(I,{"data-testid":"file-explorer-more-button",variant:"text",tabIndex:-1,size:"xs",className:"mb-0","aria-label":"More options",children:(0,a.jsx)(vt,{strokeWidth:2,className:"w-5 h-5 hidden group-hover:block"})})}),b()]})]})]})},va=t=>{let e=(0,J.c)(3),{node:i}=t;if(!i.data.isDirectory){let s;return e[0]===Symbol.for("react.memo_cache_sentinel")?(s=(0,a.jsx)("span",{className:"w-5 h-5 shrink-0"}),e[0]=s):s=e[0],s}let n;return e[1]===i.isOpen?n=e[2]:(n=i.isOpen?(0,a.jsx)(mt,{className:"w-5 h-5 shrink-0"}):(0,a.jsx)(xt,{className:"w-5 h-5 shrink-0"}),e[1]=i.isOpen,e[2]=n),n};function Ie(t,e){t.stopPropagation(),t.preventDefault(),Lt(e)}function Ee(t,e){if(e)return t;let i=[];for(let n of t){if(ba(n.name))continue;let s=n;if(n.children){let r=Ee(n.children,e);r!==n.children&&(s={...n,children:r})}i.push(s)}return i}function ba(t){return!!t.startsWith(".")}function wa(){return null}function ka(t){let{parentNode:e}=t;return!e.data.isDirectory}function Fa(t){return t.stopPropagation()}var Ca=ie(),Na=()=>{let t=(0,Ca.c)(20),{ref:e,height:i}=Vt(),n=i===void 0?1:i,s;t[0]===Symbol.for("react.memo_cache_sentinel")?(s={noClick:!0,noKeyboard:!0},t[0]=s):s=t[0];let{getRootProps:r,getInputProps:d,isDragActive:h}=Ae(s),m;t[1]===r?m=t[2]:(m=r(),t[1]=r,t[2]=m);let p;t[3]===Symbol.for("react.memo_cache_sentinel")?(p=he("flex flex-col flex-1 overflow-hidden relative"),t[3]=p):p=t[3];let l;t[4]===d?l=t[5]:(l=d(),t[4]=d,t[5]=l);let u;t[6]===l?u=t[7]:(u=(0,a.jsx)("input",{...l}),t[6]=l,t[7]=u);let y;t[8]===h?y=t[9]:(y=h&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center uppercase justify-center text-xl font-bold text-primary/90 bg-accent/85 z-10 border-2 border-dashed border-primary/90 rounded-lg pointer-events-none",children:"Drop files here"}),t[8]=h,t[9]=y);let g;t[10]===n?g=t[11]:(g=(0,a.jsx)(fa,{height:n}),t[10]=n,t[11]=g);let c;t[12]!==e||t[13]!==g?(c=(0,a.jsx)("div",{ref:e,className:"flex flex-col flex-1 overflow-hidden",children:g}),t[12]=e,t[13]=g,t[14]=c):c=t[14];let v;return t[15]!==m||t[16]!==u||t[17]!==y||t[18]!==c?(v=(0,a.jsx)(ea,{children:(0,a.jsxs)("div",{...m,className:p,children:[u,y,c]})}),t[15]=m,t[16]=u,t[17]=y,t[18]=c,t[19]=v):v=t[19],v};export{Na as default};
