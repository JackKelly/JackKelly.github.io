import{s as A}from"./chunk-LvLJmgfZ.js";import{d as ee,p as te,u as F}from"./useEvent-BhXAndur.js";import{t as re}from"./react-Bj1aDYRI.js";import{A as le,G as L,Jn as se,er as ae}from"./cells-BvQJ_wGv.js";import"./react-dom-CSu739Rf.js";import{t as ie}from"./compiler-runtime-B3qBwwSJ.js";import{t as ne}from"./jsx-runtime-BttUhiRM.js";import{t as oe}from"./cn-BfqzeB_k.js";import"./dist-m6mzfYjs.js";import"./cjs-BFk44HyO.js";import"./main-Drs5hZkn.js";import"./useNonce-CGCAoh-I.js";import{t as de}from"./createLucideIcon-C5NDK5NL.js";import{n as ce,r as U}from"./CellStatus-CXzj7sRm.js";import{r as me}from"./x-CvUjX6Qu.js";import{t as pe}from"./chevron-right-Cez-Jqdk.js";import{t as ue}from"./circle-check-DwXZ6wul.js";import{t as he}from"./circle-play-DjSRfMkE.js";import"./dist-Sapk1n6W.js";import"./dist-DAxpo7DH.js";import"./dist-Dw5p3QBM.js";import"./dist-ChjglRRU.js";import"./dist-Dq6dViu8.js";import"./session-BH_ggR75.js";import{r as fe}from"./useTheme-BHn95Ieq.js";import"./Combination-CdkqT4eF.js";import{t as G}from"./tooltip-D13BIptq.js";import"./vega-loader.browser-BR6dmQ_3.js";import{r as xe,t as ve}from"./react-vega-BAVgRRRE.js";import"./defaultLocale-YxeC1tYk.js";import"./defaultLocale-BgG6rTtO.js";import{t as ge}from"./cell-link-HggHOhac.js";import{t as je}from"./bundle.esm-CvMga-X6.js";import{n as ye,r as Ie,t as J}from"./react-resizable-panels.browser.esm-DzNEmH2W.js";import{t as Se}from"./empty-state-DlQg-nUq.js";import"./multi-icon-D7W4mYWz.js";import{r as be}from"./panel-context-Dt_6WOwy.js";import{t as Ne}from"./clear-button-Iy93qpY9.js";import{n as Te,t as we}from"./runs-CeGA8yfw.js";var ke=de("circle-ellipsis",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M17 12h.01",key:"1m0b6t"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M7 12h.01",key:"eqddd0"}]]),H=ie(),C=A(re(),1);const V="hoveredCellId",Y="cellHover";var Re="cellNum",K="cell",O="startTimestamp",Q="endTimestamp",W="status";function _e(t,e,r,a){let i="hoursminutessecondsmilliseconds";return{$schema:"https://vega.github.io/schema/vega-lite/v6.json",background:a==="dark"?"black":void 0,mark:{type:"bar",cornerRadius:2},params:[{name:V,bind:{element:`#${e}`}},{name:Y,select:{type:"point",on:"mouseover",fields:[K],clear:"mouseout"}}],height:{step:r==="sideBySide"?26:21},encoding:{y:{field:Re,scale:{paddingInner:.2},sort:{field:"sortPriority"},title:"cell",axis:r==="sideBySide"?null:void 0},x:{field:O,type:"temporal",axis:{orient:"top",title:null}},x2:{field:Q,type:"temporal"},tooltip:[{field:O,type:"temporal",timeUnit:i,title:"Start"},{field:Q,type:"temporal",timeUnit:i,title:"End"}],size:{value:{expr:`${V} == toString(datum.${K}) ? 19.5 : 18`}},color:{field:W,scale:{domain:["success","error"],range:["#37BE5F","red"]},legend:null}},data:{values:t},transform:[{calculate:`datum.${W} === 'queued' ? 9999999999999 : datum.${O}`,as:"sortPriority"}],config:{view:{stroke:"transparent"}}}}function X(t){try{let e=new Date(t*1e3);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}.${String(e.getMilliseconds()).padStart(3,"0")}`}catch{return""}}var l=A(ne(),1),Z=te(new Map);const Me=()=>{let t=(0,H.c)(34),{runIds:e,runMap:r}=F(we),a=F(Z),{clearRuns:i}=Te(),{theme:n}=fe(),[s,w]=(0,C.useState)("above"),N=be(),c;t[0]===s?c=t[1]:(c=()=>{w(s==="above"?"sideBySide":"above")},t[0]=s,t[1]=c);let m=c;if(e.length===0){let p;return t[2]===Symbol.for("react.memo_cache_sentinel")?(p=(0,l.jsx)(Se,{title:"No traces",description:(0,l.jsx)("span",{children:"Cells that have ran will appear here."}),icon:(0,l.jsx)(ae,{})}),t[2]=p):p=t[2],p}let u;t[3]===Symbol.for("react.memo_cache_sentinel")?(u=(0,l.jsx)("label",{htmlFor:"chartPosition",className:"text-xs",children:"Inline chart"}),t[3]=u):u=t[3];let y=s==="sideBySide",o;t[4]!==y||t[5]!==m?(o=(0,l.jsxs)("div",{className:"flex flex-row gap-1 items-center",children:[u,(0,l.jsx)("input",{type:"checkbox",name:"chartPosition","data-testid":"chartPosition",onClick:m,defaultChecked:y,className:"h-3 cursor-pointer"})]}),t[4]=y,t[5]=m,t[6]=o):o=t[6];let h;t[7]===i?h=t[8]:(h=(0,l.jsx)(Ne,{dataTestId:"clear-traces-button",onClick:i}),t[7]=i,t[8]=h);let v;t[9]!==o||t[10]!==h?(v=(0,l.jsxs)("div",{className:"flex flex-row justify-start gap-3",children:[o,h]}),t[9]=o,t[10]=h,t[11]=v):v=t[11];let g;if(t[12]!==s||t[13]!==a||t[14]!==e||t[15]!==r||t[16]!==n){let p;t[18]!==s||t[19]!==a||t[20]!==r||t[21]!==n?(p=(_,E)=>{let R=r.get(_);return R?(0,l.jsx)($e,{run:R,isExpanded:a.get(R.runId),isMostRecentRun:E===0,chartPosition:s,theme:n},R.runId):null},t[18]=s,t[19]=a,t[20]=r,t[21]=n,t[22]=p):p=t[22],g=e.map(p),t[12]=s,t[13]=a,t[14]=e,t[15]=r,t[16]=n,t[17]=g}else g=t[17];let j;t[23]===g?j=t[24]:(j=(0,l.jsx)("div",{className:"flex flex-col gap-3",children:g}),t[23]=g,t[24]=j);let T;t[25]!==v||t[26]!==j?(T=(0,l.jsxs)("div",{className:"py-1 px-2 overflow-y-scroll h-full",children:[v,j]}),t[25]=v,t[26]=j,t[27]=T):T=t[27];let f=T;if(N==="sidebar")return f;let x;t[28]===f?x=t[29]:(x=(0,l.jsx)(J,{defaultSize:50,minSize:30,maxSize:80,children:f}),t[28]=f,t[29]=x);let d;t[30]===Symbol.for("react.memo_cache_sentinel")?(d=(0,l.jsx)(Ie,{className:"w-1 bg-border hover:bg-primary/50 transition-colors"}),t[30]=d):d=t[30];let I;t[31]===Symbol.for("react.memo_cache_sentinel")?(I=(0,l.jsx)(J,{defaultSize:50,children:(0,l.jsx)("div",{})}),t[31]=I):I=t[31];let S;return t[32]===x?S=t[33]:(S=(0,l.jsxs)(ye,{direction:"horizontal",className:"h-full",children:[x,d,I]}),t[32]=x,t[33]=S),S};var $e=({run:t,isMostRecentRun:e,chartPosition:r,isExpanded:a,theme:i})=>{let n=ee(Z);a??(a=e);let s=()=>{n(c=>{let m=new Map(c);return m.set(t.runId,!a),m})},w=(0,l.jsx)(a?me:pe,{height:16,className:"inline"}),N=(0,l.jsxs)("span",{className:"text-sm cursor-pointer",onClick:s,children:["Run - ",L(t.runStartTime),w]});return a?(0,l.jsx)(ze,{run:t,chartPosition:r,theme:i,title:N},t.runId):(0,l.jsx)("div",{className:"flex flex-col",children:(0,l.jsx)("pre",{className:"font-mono font-semibold",children:N})},t.runId)},ze=t=>{let e=(0,H.c)(40),{run:r,chartPosition:a,theme:i,title:n}=t,[s,w]=(0,C.useState)(),N=(0,C.useRef)(null),{ref:c,width:m}=je(),u=m===void 0?300:m,y=le(),o,h;if(e[0]!==y||e[1]!==a||e[2]!==r.cellRuns||e[3]!==r.runId||e[4]!==i){let k=[...r.cellRuns.values()].map(b=>{let M=b.elapsedTime??0;return{cell:b.cellId,cellNum:y.inOrderIds.indexOf(b.cellId),startTimestamp:X(b.startTime),endTimestamp:X(b.startTime+M),elapsedTime:U(M*1e3),status:b.status}});o=`hiddenInputElement-${r.runId}`,h=xe(_e(k,o,a,i)),e[0]=y,e[1]=a,e[2]=r.cellRuns,e[3]=r.runId,e[4]=i,e[5]=o,e[6]=h}else o=e[5],h=e[6];let v=h.spec,g=i==="dark"?"dark":void 0,j=u-50,T=a==="above"?120:100,f;e[7]!==g||e[8]!==j||e[9]!==T?(f={theme:g,width:j,height:T,actions:!1,mode:"vega",renderer:"canvas"},e[7]=g,e[8]=j,e[9]=T,e[10]=f):f=e[10];let x;e[11]!==f||e[12]!==v?(x={ref:N,spec:v,options:f},e[11]=f,e[12]=v,e[13]=x):x=e[13];let d=ve(x),I;e[14]===(d==null?void 0:d.view)?I=e[15]:(I=()=>{let k=[{signalName:Y,handler:(b,M)=>{var q;let P=(q=M.cell)==null?void 0:q[0];w(P??null)}}];return k.forEach(b=>{let{signalName:M,handler:P}=b;d==null||d.view.addSignalListener(M,P)}),()=>{k.forEach(b=>{let{signalName:M,handler:P}=b;d==null||d.view.removeSignalListener(M,P)})}},e[14]=d==null?void 0:d.view,e[15]=I);let S;e[16]===d?S=e[17]:(S=[d],e[16]=d,e[17]=S),(0,C.useEffect)(I,S);let p;e[18]!==o||e[19]!==s||e[20]!==r?(p=(0,l.jsx)(Ce,{run:r,hoveredCellId:s,hiddenInputElementId:o}),e[18]=o,e[19]=s,e[20]=r,e[21]=p):p=e[21];let _=p,E=a==="sideBySide"?"-mt-0.5 flex-1":"",R;e[22]===Symbol.for("react.memo_cache_sentinel")?(R=(0,l.jsx)(C.Suspense,{children:(0,l.jsx)("div",{ref:N})}),e[22]=R):R=e[22];let B;e[23]!==c||e[24]!==E?(B=(0,l.jsx)("div",{className:E,ref:c,children:R}),e[23]=c,e[24]=E,e[25]=B):B=e[25];let $=B;if(a==="above"){let k;e[26]!==$||e[27]!==n||e[28]!==_?(k=(0,l.jsxs)("pre",{className:"font-mono font-semibold",children:[n,$,_]}),e[26]=$,e[27]=n,e[28]=_,e[29]=k):k=e[29];let b;return e[30]!==r.runId||e[31]!==k?(b=(0,l.jsx)("div",{className:"flex flex-col",children:k},r.runId),e[30]=r.runId,e[31]=k,e[32]=b):b=e[32],b}let z;e[33]!==n||e[34]!==_?(z=(0,l.jsxs)("pre",{className:"font-mono font-semibold",children:[n,_]}),e[33]=n,e[34]=_,e[35]=z):z=e[35];let D;return e[36]!==$||e[37]!==r.runId||e[38]!==z?(D=(0,l.jsxs)("div",{className:"flex flex-row",children:[z,$]},r.runId),e[36]=$,e[37]=r.runId,e[38]=z,e[39]=D):D=e[39],D},Ce=t=>{let e=(0,H.c)(12),{run:r,hoveredCellId:a,hiddenInputElementId:i}=t,n=(0,C.useRef)(null),s;e[0]===Symbol.for("react.memo_cache_sentinel")?(s=o=>{n.current&&(n.current.value=String(o),n.current.dispatchEvent(new Event("input",{bubbles:!0})))},e[0]=s):s=e[0];let w=s,N=a||"",c;e[1]!==i||e[2]!==N?(c=(0,l.jsx)("input",{type:"text",id:i,defaultValue:N,hidden:!0,ref:n}),e[1]=i,e[2]=N,e[3]=c):c=e[3];let m;e[4]===r.cellRuns?m=e[5]:(m=[...r.cellRuns.values()],e[4]=r.cellRuns,e[5]=m);let u;e[6]!==a||e[7]!==m?(u=m.map(o=>(0,l.jsx)(Pe,{cellRun:o,hovered:o.cellId===a,dispatchHoverEvent:w},o.cellId)),e[6]=a,e[7]=m,e[8]=u):u=e[8];let y;return e[9]!==c||e[10]!==u?(y=(0,l.jsxs)("div",{className:"text-xs mt-0.5 ml-3 flex flex-col gap-0.5",children:[c,u]}),e[9]=c,e[10]=u,e[11]=y):y=e[11],y},Ee={success:(0,l.jsx)(ue,{color:"green",size:14}),running:(0,l.jsx)(he,{color:"var(--blue-10)",size:14}),error:(0,l.jsx)(se,{color:"red",size:14}),queued:(0,l.jsx)(ke,{color:"grey",size:14})},Pe=t=>{let e=(0,H.c)(39),{cellRun:r,hovered:a,dispatchHoverEvent:i}=t,n;e[0]===r.elapsedTime?n=e[1]:(n=r.elapsedTime?U(r.elapsedTime*1e3):"-",e[0]=r.elapsedTime,e[1]=n);let s=n,w;e[2]!==r.elapsedTime||e[3]!==s?(w=r.elapsedTime?(0,l.jsxs)("span",{children:["This cell took ",(0,l.jsx)(ce,{elapsedTime:s})," to run"]}):(0,l.jsx)("span",{children:"This cell has not been run"}),e[2]=r.elapsedTime,e[3]=s,e[4]=w):w=e[4];let N=w,c;e[5]!==r.cellId||e[6]!==i?(c=()=>{i(r.cellId)},e[5]=r.cellId,e[6]=i,e[7]=c):c=e[7];let m=c,u;e[8]===i?u=e[9]:(u=()=>{i(null)},e[8]=i,e[9]=u);let y=u,o=a&&"bg-(--gray-3) opacity-100",h;e[10]===o?h=e[11]:(h=oe("flex flex-row gap-2 py-1 px-1 opacity-70 hover:bg-(--gray-3) hover:opacity-100",o),e[10]=o,e[11]=h);let v;e[12]===r.startTime?v=e[13]:(v=L(r.startTime),e[12]=r.startTime,e[13]=v);let g;e[14]===v?g=e[15]:(g=(0,l.jsxs)("span",{className:"text-(--gray-10) dark:text-(--gray-11)",children:["[",v,"]"]}),e[14]=v,e[15]=g);let j;e[16]===r.cellId?j=e[17]:(j=(0,l.jsxs)("span",{className:"text-(--gray-10) w-16 overflow-hidden",children:["(",(0,l.jsx)(ge,{cellId:r.cellId}),")"]}),e[16]=r.cellId,e[17]=j);let T;e[18]===r.code?T=e[19]:(T=(0,l.jsx)("span",{className:"w-40 truncate -ml-1",children:r.code}),e[18]=r.code,e[19]=T);let f;e[20]===s?f=e[21]:(f=(0,l.jsx)("span",{className:"text-(--gray-10) dark:text-(--gray-11)",children:s}),e[20]=s,e[21]=f);let x;e[22]!==N||e[23]!==f?(x=(0,l.jsx)(G,{content:N,children:f}),e[22]=N,e[23]=f,e[24]=x):x=e[24];let d=Ee[r.status],I;e[25]!==r.status||e[26]!==d?(I=(0,l.jsx)(G,{content:r.status,children:d}),e[25]=r.status,e[26]=d,e[27]=I):I=e[27];let S;e[28]!==x||e[29]!==I?(S=(0,l.jsxs)("div",{className:"flex flex-row gap-1 w-16 justify-end -ml-2",children:[x,I]}),e[28]=x,e[29]=I,e[30]=S):S=e[30];let p;return e[31]!==m||e[32]!==y||e[33]!==T||e[34]!==S||e[35]!==h||e[36]!==g||e[37]!==j?(p=(0,l.jsxs)("div",{className:h,onMouseEnter:m,onMouseLeave:y,children:[g,j,T,S]}),e[31]=m,e[32]=y,e[33]=T,e[34]=S,e[35]=h,e[36]=g,e[37]=j,e[38]=p):p=e[38],p};export{Me as Tracing};
